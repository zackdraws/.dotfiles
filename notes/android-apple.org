# === STEP 1: Download and set up Android command line tools ===

mkdir -p ~/Library/Android/sdk/cmdline-tools
cd ~/Library/Android/sdk

# Download using curl (use wget if you prefer)
curl -o cmdline-tools.zip https://dl.google.com/android/repository/commandlinetools-mac-11076708_latest.zip

# Unzip and move into 'latest' directory
unzip cmdline-tools.zip -d cmdline-tools
mv cmdline-tools/cmdline-tools cmdline-tools/latest

# === STEP 2: Set environment variables (Fish shell) ===

# TEMPORARY for current session
set -x ANDROID_HOME ~/Library/Android/sdk
set -x PATH $ANDROID_HOME/cmdline-tools/latest/bin $ANDROID_HOME/platform-tools $ANDROID_HOME/emulator $PATH

# OPTIONAL: Add to fish config for persistence
echo 'set -x ANDROID_HOME ~/Library/Android/sdk' >> ~/.config/fish/config.fish
echo 'set -x PATH $ANDROID_HOME/cmdline-tools/latest/bin $ANDROID_HOME/platform-tools $ANDROID_HOME/emulator $PATH' >> ~/.config/fish/config.fish

# Reload fish config
source ~/.config/fish/config.fish

# === STEP 3: Accept licenses and install SDK components ===

# Accept licenses
sdkmanager --licenses

# Install required SDK components
sdkmanager "platform-tools" "platforms;android-34" "build-tools;35.0.0"

# === STEP 4: Build your project ===

cd ~/projects/soundbound-extensions-lib
./gradlew build
