;; Basic Emacs Settings
(setq inhibit-startup-message t)  ;; Disable startup message
(tool-bar-mode -1)                ;; Hide toolbar
(menu-bar-mode -1)                ;; Hide menu bar
(scroll-bar-mode -1)              ;; Hide scroll bars
(cua-mode t)                      ;; Enable CUA keybindings 
;; Set font
(set-frame-font "Fira Code Regular" t)
;; Set frame title to current directory
(setq frame-title-format '((:eval default-directory)))
;; Disable file prompts for custom themes (bypass theme permission)
(setq custom-safe-themes t)
;; Load and configure the theme
(use-package catppuccin
  :ensure t
  :config
  (load-theme 'catppuccin :no-confirm)
  (add-to-list 'custom-safe-themes (car (last (custom-theme-load-path)))))
;; Package Management Setup
(require 'package)
(package-initialize)  ;; Make sure packages are initialized
;; Enable use-package
(require 'use-package)
(setq use-package-always-ensure t)
;; Org Mode Setup
(require 'org)
(require 'org-roam)
(require 'org-roam-ui)
(require 'pdf-tools)
;; Org Mode Settings
(setq org-agenda-files '("C:/S/EM/O" "C:/S/2025/T/"))
(setq org-latex-listings 'minted)
(setq org-startup-with-inline-images t)
(setq org-image-actual-width (list 260))
;; Org-Roam Setup
(setq org-roam-directory "c:/s/em/o/")
(setq org-roam-capture-templates
      '(("d" "default" plain "%?"
         :target (file+head "${slug}.org"
                           "#+title: ${title}\n"))))
(setq org-roam-node-display-template
      (concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))
(org-roam-db-autosync-mode)
;; Org-Roam UI Setup
(use-package org-roam-ui
  :after org-roam
  :ensure t
  :config
  (setq org-roam-ui-sync-theme t
        org-roam-ui-follow t
        org-roam-ui-update-on-save t
        org-roam-ui-open-on-start t))
;; PDF Tools Setup
(pdf-tools-install)
(setq TeX-view-program-selection '((output-pdf "PDF Tools"))
      TeX-view-program-list '(("PDF Tools" TeX-pdf-tools-sync-view))
      TeX-source-correlate-start-server t)
(setq pdf-view-use-scaling t)
(setq pdf-view-resize-factor 1.05)
;; Org-Mode and Calendar Setup
(setq org-duration-format 'h:mm)
(require 'calfw)
(require 'calfw-org)
(setq cfw:org-agenda-schedule-args '(:timestamp))
;; Bindings for convenience (keybindings)
(global-set-key (kbd "C-c n j") 'org-roam-dailies-capture-today)
(global-set-key (kbd "C-c n i") 'org-roam-node-insert)
(global-set-key (kbd "C-c n c") 'org-roam-node-capture)
(global-set-key (kbd "C-c n g") 'org-roam-node-find)
(global-set-key (kbd "C-c n l") 'org-roam-buffer-toggle)
(global-set-key (kbd "C-c q") 'make-directory)
(global-set-key (kbd "C-c t") 'set-frame-alpha)
(global-set-key (kbd "C-c n f") 'org-roam-node-find)
(global-set-key (kbd "C-c l") #'org-store-link)    
(global-set-key (kbd "C-c a") #'org-agenda)
(global-set-key (kbd "C-c c") #'org-capture)  
(global-set-key (kbd "C-c f") #'neotree-dir)
(global-set-key (kbd "C-c h") #'neotree-toggle)
(global-set-key (kbd "C-c g") #'0blayout-switch)
(global-set-key (kbd "C-c w") 'peep-dired)
(global-set-key (kbd "C-c h") 'httpd-serve-directory)
(global-set-key (kbd "C-c e") 'impatient-mode)
(global-set-key (kbd "C-c m") 'magit)
(global-set-key (kbd "C-c r") 'counsel-outline)
(global-set-key (kbd "C-c i") 'overwrite-mode)
(global-set-key (kbd "C-c d") 'org-clock-timestamps-down) 
(global-set-key (kbd "C-c e") 'org-clock-timestamps-up)
;; Override Dired Mode with Dirvish (if you have dirvish installed)
(use-package dirvish
  :ensure t
  :config
  (dirvish-override-dired-mode))
;; Use Ivy for enhanced search and selection
(ivy-mode)
;; Enable Org Download and Image Handling
(require 'org-download)
(add-hook 'dired-mode-hook 'org-download-enable)
(setq org-download-method 'directory)
(setq org-download-image-dir (concat (file-name-sans-extension (buffer-file-name)) "-img"))
(setq org-download-image-org-width 80)
(setq org-download-link-format "[[file:%s]]\n"
      org-download-abbreviate-filename-function #'file-relative-name)
;; Enable Auto-complete Mode
(global-auto-complete-mode t)
(ac-config-default)
;; Configure OpenWith for File Associations
(require 'openwith)
(setq openwith-associations
      '(("\\.mp4\\'" "mpv" (file))))
(openwith-mode t)
;; Ensure safe evaluation of forms
(setq enable-local-eval t)
(setq safe-local-eval-forms '((progn (org-agenda-list) (other-window 1))))
;; Set up hooks and additional settings
(add-hook 'TeX-after-compilation-finished-functions #'TeX-revert-document-buffer)
(add-hook 'image-mode-hook 'scale-image-register-hook)
;; Enable PDF Sync
(setq TeX-source-correlate-mode t)
(setq font-latex-fontify-script nil)
(setq reftex-extra-bindings t)
