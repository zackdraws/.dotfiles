#!/bin/bash

# org2docx_pandoc.sh: Convert .org to .docx using Emacs (Org → Markdown) and Pandoc

set -e

# Check dependencies
command -v emacs >/dev/null 2>&1 || { echo "Emacs not found."; exit 1; }
command -v pandoc >/dev/null 2>&1 || { echo "Pandoc not found."; exit 1; }

# Input Org file
ORG_FILE="$1"

if [[ -z "$ORG_FILE" ]]; then
  echo "Usage: $0 file.org"
  exit 1
fi

if [[ ! -f "$ORG_FILE" ]]; then
  echo "File not found: $ORG_FILE"
  exit 1
fi

# Derive base names
BASENAME=$(basename "$ORG_FILE" .org)E}.md"
DOCX
MD_FILE="${BASENAM_FILE="${BASENAME}.docx"

# Step 1: Export Org to Markdown using Emacs
emacs "$ORG_FILE" --batch \
  --eval="(progn
             (find-file \"$ORG_FILE\")
             (org-md-export-to-markdown)
             (kill-emacs))"

# Step 2: Convert Markdown to DOCX using Pandoc
pandoc "$MD_FILE" -o "$DOCX_FILE"

# Cleanup optional: remove the intermediate markdown
# rm "$MD_FILE"

echo "✅ Exported: $DOCX_FILE"
